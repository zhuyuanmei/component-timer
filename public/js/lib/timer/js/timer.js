define(function(){var e={add:function(e,t,n){var i=e+"="+escape(t);if(n>0){var s=new Date;s.setTime(s.getTime()+1e3*n),i=i+";expires="+s.toUTCString()}document.cookie=i},edit:function(e,t,n){var i=e+"="+escape(t);if(n>0){var s=new Date;s.setTime(s.getTime()+1e3*n),i=i+";expires="+s.toGMTString()}document.cookie=i},get:function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return t?window.unescape(t[2]):""}},t=function(e){this.settings=$.extend({},t.defaults,e),this.init()};t.prototype={init:function(){this.create()},create:function(){var t=this,n=t.settings.codeBtn,i=t.settings.errorTip,s=t.settings.onlyFlag,o="string"==typeof t.settings.length?parseInt(t.settings.length):t.settings.length;n.on("click",function(){var r=$(this);r.hasClass("disabled-code")||$.ajax({type:"post",url:r.attr("data-url"),data:{},dataType:"json",success:function(r){if(r.flag){n.addClass("disabled-code");var a="timerRemained"+s;e.add(a,o,60),t.setCountDown(n,a)}else t.errorTip(i,r.msg)},error:function(){t.errorTip(i,"请求服务器异常,稍后再试")}})})},setCountDown:function(t,n){var i=this,s=parseInt(e.get(n));return s?(t.addClass("disabled-code"),t.val(s+"s后重新发送"),s--,e.edit(n,s,s+1),void setTimeout(function(){i.setCountDown(t,n)},1e3)):(t.removeClass("disabled-code"),t.val("短信获取"),!1)},errorTip:function(e,t){e.show(),e.text(t),setTimeout(function(){e.removeClass("error-tip"),e.addClass("error-tip-fade"),setTimeout(function(){e.removeClass("error-tip-fade"),e.addClass("error-tip"),e.hide()},500)},2e3)}},t.defaults={onlyFlag:"18888888888",length:60,codeBtn:null,errorTip:null};var n=function(e){new t(e)};window.rTimer=$.rTimer=$.timer=n});